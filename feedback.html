<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Rate My Work | KEEJAH MWandu</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  .star { font-size:1.5rem; cursor:pointer; color:#ddd; }
  .star.selected { color:gold; }
</style>
</head>
<body class="bg-light text-dark">

<div class="container my-5">
  <div class="text-center mb-4">
    <h1>Rate My Work</h1>
    <a href="index.html" class="btn btn-secondary mt-2">← Back to Home</a>
  </div>

  <div id="avgRatingContainer" class="text-center mb-3" style="display:none;">
    ⭐ <strong id="avgRating">0</strong>/5 average from <span id="totalRatings">0</span> ratings.
  </div>

  <div id="thankyou" class="alert alert-success text-center mb-3" style="display:none;">
    Thank you for your feedback!
  </div>

  <form id="ratingForm" class="text-center mb-5">
    <div class="mb-3">
      <div id="stars">
        <span class="star" data-value="1">★</span>
        <span class="star" data-value="2">★</span>
        <span class="star" data-value="3">★</span>
        <span class="star" data-value="4">★</span>
        <span class="star" data-value="5">★</span>
      </div>
      <input type="hidden" id="ratingInput" required>
    </div>
    <div class="mb-3">
      <input type="email" id="email" class="form-control" placeholder="Your Email (optional)">
    </div>
    <div class="mb-3">
      <textarea id="comment" class="form-control" rows="3" placeholder="Your comment"></textarea>
    </div>
    <button type="submit" class="btn btn-primary">Submit Rating</button>
  </form>

  <h2 class="text-center">What Others Said</h2>
  <ul id="ratingsList" class="list-group"></ul>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // Store ratings in localStorage
  const stars = document.querySelectorAll('.star');
  const ratingInput = document.getElementById('ratingInput');
  const ratingsList = document.getElementById('ratingsList');
  const avgRatingContainer = document.getElementById('avgRatingContainer');
  const avgRatingEl = document.getElementById('avgRating');
  const totalRatingsEl = document.getElementById('totalRatings');
  const thankyou = document.getElementById('thankyou');

  // Highlight stars
  stars.forEach(star => {
    star.addEventListener('click', () => {
      const val = star.dataset.value;
      ratingInput.value = val;
      stars.forEach(s => s.classList.remove('selected'));
      for (let i = 0; i < val; i++) stars[i].classList.add('selected');
    });
  });

  // Load ratings from localStorage
  let allRatings = JSON.parse(localStorage.getItem('ratings')) || [];

  function updateRatings() {
    ratingsList.innerHTML = '';
    if (allRatings.length === 0) {
      ratingsList.innerHTML = '<p class="text-center">No feedback yet.</p>';
      avgRatingContainer.style.display = 'none';
      return;
    }

    // Show average
    const sum = allRatings.reduce((a,b) => a+b.rating,0);
    const avg = (sum/allRatings.length).toFixed(1);
    avgRatingEl.textContent = avg;
    totalRatingsEl.textContent = allRatings.length;
    avgRatingContainer.style.display = 'block';

    // Show all comments
    allRatings.slice().reverse().forEach(r => {
      const li = document.createElement('li');
      li.className = 'list-group-item';
      li.innerHTML = `<strong>${'★'.repeat(r.rating)}</strong><br>
                      ${r.comment}<div class="small text-muted">${new Date(r.time).toLocaleDateString()}</div>`;
      ratingsList.appendChild(li);
    });
  }

  updateRatings();

  // Handle form submission
  document.getElementById('ratingForm').addEventListener('submit', e => {
    e.preventDefault();
    const rating = parseInt(ratingInput.value);
    const comment = document.getElementById('comment').value.trim();
    const email = document.getElementById('email').value.trim();

    if (!rating) return alert('Please select a rating');

    allRatings.push({ rating, comment, email, time: Date.now() });
    localStorage.setItem('ratings', JSON.stringify(allRatings));
    updateRatings();

    // Reset form
    e.target.reset();
    stars.forEach(s => s.classList.remove('selected'));
    thankyou.style.display = 'block';
    setTimeout(() => thankyou.style.display='none', 3000);
  });
</script>

</body>
</html>
